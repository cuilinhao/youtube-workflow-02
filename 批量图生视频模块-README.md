# 批量图生视频模块功能说明

## 模块概述

【批量图生视频】模块是一个完整的视频生成管理系统，主要功能是将图片转换为视频，使用 **Veo3** 模型进行视频生成。该模块支持任务管理、批量处理、实时监控、错误处理等完整功能。

## 核心功能

### 1. 任务管理功能

#### 1.1 任务列表展示
- **表格展示**：编号、参考图、提示词、状态、进度、生成文件
- **状态标识**：不同颜色标识不同状态
  - 等待中：灰色
  - 生成中：蓝色
  - 下载中：黄色
  - 成功：绿色
  - 失败：红色
- **进度条**：实时显示生成进度
- **文件管理**：显示生成的视频文件路径

#### 1.2 任务状态跟踪
```
等待中 → 生成中 → 任务已提交，等待处理... → 生成完成，开始下载... → 成功/失败
```

#### 1.3 批量操作
- **批量删除**：选中多个任务进行批量删除
- **清空全部**：一键清空所有任务
- **批量生成**：启动选中的任务或全部任务

### 2. 任务创建功能

#### 2.1 单任务创建
- **手动添加**：通过表单手动添加单个视频任务
- **参数配置**：长宽比、水印、回调URL、种子值等
- **图片上传**：支持单张图片上传

#### 2.2 批量任务创建
- **CSV文件导入**：支持CSV文件批量导入任务
- **文件夹上传**：支持整个文件夹的图片批量上传
- **参数预设**：从全局设置中读取默认参数

#### 2.3 图片处理
- **图片格式支持**：支持常见图片格式
- **URL支持**：支持在线图片URL
- **本地文件**：支持本地图片文件上传

### 3. 视频生成功能

#### 3.1 API配置
```typescript
// 视频生成API配置
const GENERATE_URL = 'https://api.kie.ai/api/v1/veo/generate';
const RECORD_URL = 'https://api.kie.ai/api/v1/veo/record-info';

// 使用模型
model: 'veo3_fast'
```

#### 3.2 支持的参数
- **长宽比**：16:9、9:16、1:1、4:3
- **水印**：可选的视频水印
- **回调URL**：生成完成后的回调地址
- **种子值**：控制生成随机性
- **回退机制**：生成失败时的备用方案
- **翻译功能**：自动翻译提示词

#### 3.3 并发控制
- **多线程处理**：支持多线程并发生成视频
- **可配置并发数**：默认5个线程
- **智能任务调度**：自动分配任务到可用线程

#### 3.4 重试机制
- **自动重试**：失败任务自动重试
- **重试次数**：可配置重试次数
- **指数退避**：重试间隔逐渐增加

### 4. 实时监控功能

#### 4.1 状态监控
- **实时刷新**：5秒自动刷新正在运行的任务状态
- **进度跟踪**：实时显示每个任务的生成进度
- **整体进度**：显示当前批次整体进度

#### 4.2 日志记录
- **详细日志**：记录每个任务的详细执行过程
- **错误日志**：记录失败任务的错误信息
- **性能统计**：记录任务执行时间和性能数据

### 5. 文件管理功能

#### 5.1 文件下载
- **自动下载**：生成完成后自动下载视频文件
- **文件命名**：根据任务编号自动命名
- **路径管理**：支持自定义保存路径

#### 5.2 文件存储
- **本地存储**：视频文件保存到本地指定目录
- **路径配置**：可配置视频存储文件夹
- **文件组织**：按任务编号组织文件

### 6. 用户界面功能

#### 6.1 任务列表界面
- **表格展示**：清晰的任务信息展示
- **状态筛选**：可按状态筛选任务
- **排序功能**：支持按编号、状态等排序
- **搜索功能**：支持任务搜索

#### 6.2 任务创建界面
- **表单输入**：直观的表单输入界面
- **文件上传**：支持拖拽上传和点击上传
- **参数配置**：完整的参数配置选项
- **预览功能**：上传前预览图片

#### 6.3 操作功能
- **编辑提示词**：双击可编辑任务提示词
- **删除任务**：单个删除或批量删除
- **开始生成**：启动选中的任务或全部任务
- **文件夹选择**：设置视频保存路径

### 7. 与工作流的集成

#### 7.1 视频生成工作流
在 `VideoWorkflow` 组件中，【批量图生视频】是工作流的最后一步：

1. **输入脚本** → 2. **生成分镜** → 3. **批量出图** → 4. **编辑排序** → 5. **视频提示词** → **6. 批量出视频** → 7. **导出结果**

#### 7.2 数据流转
- 从图片生成模块接收生成的图片
- 结合脚本生成视频提示词
- 自动创建视频任务并启动生成

### 8. 配置选项

#### 8.1 全局设置
- **默认长宽比**：9:16（竖屏）
- **默认水印**：可配置
- **回调URL**：生成完成通知
- **并发数量**：控制同时生成的任务数
- **重试次数**：失败重试次数

#### 8.2 API密钥管理
- **多密钥支持**：支持多个API密钥
- **自动切换**：自动切换可用密钥
- **使用统计**：密钥使用统计和记录

### 9. 错误处理

#### 9.1 错误分类
- **网络错误**：连接超时、网络中断等
- **API错误**：API返回错误、认证失败等
- **文件错误**：文件上传失败、下载失败等
- **参数错误**：参数格式错误、参数缺失等

#### 9.2 错误处理机制
- **错误分类**：自动分类不同类型的错误
- **错误提示**：用户友好的错误提示信息
- **错误恢复**：自动尝试恢复可恢复的错误
- **错误日志**：详细的错误日志记录

### 10. 性能优化

#### 10.1 并发优化
- **智能调度**：根据系统资源智能调度任务
- **负载均衡**：合理分配任务到不同线程
- **资源管理**：有效管理内存和CPU资源

#### 10.2 网络优化
- **连接复用**：复用HTTP连接减少开销
- **超时控制**：合理的请求超时设置
- **重试策略**：智能的重试策略

### 11. 使用流程

#### 11.1 基本使用流程
1. **配置API密钥**：在设置中配置KIE.AI API密钥
2. **设置参数**：配置默认的长宽比、水印等参数
3. **创建任务**：通过表单或CSV文件创建视频任务
4. **启动生成**：点击"开始生成视频"按钮启动任务
5. **监控进度**：实时监控任务执行进度
6. **下载文件**：生成完成后下载视频文件

#### 11.2 批量处理流程
1. **准备数据**：准备图片和对应的提示词
2. **批量导入**：使用CSV文件批量导入任务
3. **参数设置**：设置统一的生成参数
4. **启动批量生成**：启动所有任务的批量生成
5. **监控进度**：监控整体生成进度
6. **结果处理**：处理生成结果和文件

### 12. 技术架构

#### 12.1 前端组件
- **VideoTaskBoard**：任务管理主界面
- **VideoTaskForm**：任务创建表单
- **VideoWorkflow**：工作流集成组件

#### 12.2 后端API
- **视频生成API**：调用KIE.AI的Veo3模型
- **任务管理API**：任务CRUD操作
- **文件管理API**：文件上传下载管理

#### 12.3 数据存储
- **任务数据**：存储在本地JSON文件中
- **文件存储**：视频文件存储在本地文件系统
- **配置数据**：API密钥和设置存储在配置文件中

### 13. 注意事项

#### 13.1 API限制
- **请求频率**：注意API请求频率限制
- **并发限制**：合理设置并发数量
- **超时设置**：设置合适的请求超时时间

#### 13.2 文件管理
- **存储空间**：注意本地存储空间使用
- **文件清理**：定期清理不需要的文件
- **备份策略**：重要文件需要备份

#### 13.3 性能考虑
- **资源使用**：监控CPU和内存使用情况
- **网络带宽**：考虑网络带宽限制
- **并发控制**：合理设置并发数量避免系统过载

### 14. 故障排除

#### 14.1 常见问题
- **API密钥错误**：检查API密钥是否正确配置
- **网络连接问题**：检查网络连接和防火墙设置
- **文件权限问题**：检查文件读写权限
- **参数配置错误**：检查参数配置是否正确

#### 14.2 调试方法
- **查看日志**：查看详细的执行日志
- **检查状态**：检查任务状态和错误信息
- **测试连接**：测试API连接是否正常
- **参数验证**：验证输入参数是否正确

### 15. 更新日志

#### 15.1 功能更新
- 支持Veo3模型视频生成
- 增加批量任务管理功能
- 优化用户界面和交互体验
- 增加实时监控和进度跟踪

#### 15.2 性能优化
- 优化并发处理性能
- 改进错误处理机制
- 增强文件管理功能
- 提升用户体验

---

## 总结

【批量图生视频】模块是一个功能完整、性能优秀的视频生成管理系统，支持从图片到视频的完整转换流程，具备任务管理、批量处理、实时监控、错误处理等完整功能，是视频生成工作流的重要组成部分。通过合理配置和使用，可以高效地完成大量视频生成任务。

